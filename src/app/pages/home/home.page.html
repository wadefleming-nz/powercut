<ion-header>
  <ion-toolbar color="primary">
    <ion-title
      ><ion-icon name="flash" class="title-icon"></ion-icon>
      <ion-text class="title-text"> Power Cut </ion-text>
      <ion-icon
        *ngIf="platform.is('ios')"
        name="flash"
        class="title-icon"
      ></ion-icon>
    </ion-title>
  </ion-toolbar>
</ion-header>
<ion-content>
  <ng-container *ngIf="showAddIncidentPopup$ | async as showAddIncidentPopup">
    <div class="container" *ngIf="incidents$ | async as incidents">
      <div class="map-container">
        <input
          type="text"
          appGoogleAddressSearch
          class="form-control"
          (placeChanged)="onPlaceChanged($event)"
          id="search_place"
        />
        <agm-map
          [latitude]="latitude"
          [longitude]="longitude"
          [zoom]="zoom"
          [zoomControlOptions]="zoomControlOptions"
          [streetViewControl]="false"
          [clickableIcons]="false"
          [usePanning]="true"
          (centerChange)="centerChanged($event)"
          (mapClick)="mapClicked()"
          ><agm-marker
            *ngFor="let incident of incidents; trackBy: trackByIncidentId"
            [latitude]="incident.latitude"
            [longitude]="incident.longitude"
            [iconUrl]="getIncidentIcon(incident)"
            [zIndex]="getIncidentZIndex(incident)"
            [markerClickable]="showAddIncidentPopup === 'false'"
            (markerClick)="incidentClicked(incident)"
          >
          </agm-marker></agm-map
        ><ion-icon
          *ngIf="centerIndicatorVisible"
          name="add-outline"
          class="center-indicator map-center"
        ></ion-icon
        ><ion-fab vertical="top" horizontal="end" slot="fixed">
          <ion-row
            ><ion-col
              ><ion-fab-button
                color="danger"
                [disabled]="showAddIncidentPopup === 'true'"
                (click)="addReportOffClicked()"
                ><ion-icon
                  name="flash-off-sharp"
                ></ion-icon></ion-fab-button></ion-col
            ><ion-col
              ><ion-fab-button
                color="success"
                [disabled]="showAddIncidentPopup === 'true'"
                (click)="addReportOnClicked()"
                ><ion-icon
                  name="flash-sharp"
                ></ion-icon></ion-fab-button></ion-col></ion-row
          ><ion-row class="ion-margin-top"></ion-row
          ><ion-row
            ><ion-col></ion-col
            ><ion-col
              ><ion-fab-button
                *ngIf="geolocationAvailable"
                color="light"
                class="ion-margin-top"
                (click)="geolocationClicked()"
              >
                <ion-icon
                  name="navigate-outline"
                ></ion-icon> </ion-fab-button></ion-col></ion-row
          ><ion-row
            ><ion-col></ion-col
            ><ion-col
              ><ion-fab-button
                color="danger"
                class="ion-margin-top"
                [disabled]="showAddIncidentPopup === 'true'"
                (click)="deleteClicked(incidents)"
                ><ion-icon
                  name="trash-outline"
                ></ion-icon> </ion-fab-button></ion-col
          ></ion-row>
        </ion-fab>
      </div>
      <div class="incident-container">
        <ion-card *ngIf="showAddIncidentPopup === 'true'">
          <ion-card-content>
            <ion-item lines="none">
              <ion-label>Event</ion-label>
              {{ getIncidentType(newIncidentStatus) }}</ion-item
            >
            <ion-item lines="none">
              <ion-label>Reported at</ion-label>
              <ion-datetime
                displayFormat="hh:mm a"
                [value]="newIncidentDateTime"
              ></ion-datetime> </ion-item
            ><ion-item lines="none">
              <ion-label>On</ion-label>
              <ion-datetime
                displayFormat="DD MMM YYYY"
                [value]="newIncidentDateTime"
              ></ion-datetime>
            </ion-item>
          </ion-card-content>
          <ion-footer class="button-border-top"
            ><ion-row class="ion-text-center">
              <ion-col size="6" class="ion-padding"
                ><ion-button
                  fill="clear"
                  class="card-footer-button"
                  (click)="addPopupCancelClicked()"
                  >Cancel</ion-button
                ></ion-col
              ><ion-col size="6" class="ion-padding button-border-left"
                ><ion-button
                  fill="clear"
                  strong="true"
                  type="submit"
                  class="card-footer-button"
                  (click)="addPopupAddClicked()"
                  >Add</ion-button
                ></ion-col
              ></ion-row
            ></ion-footer
          >
        </ion-card>
        <ion-card *ngIf="activeIncident$ | async as activeIncident">
          <ion-card-content>
            <ion-item lines="none">
              <ion-label>Event</ion-label>
              {{ getIncidentType(activeIncident.status) }}</ion-item
            >
            <ion-item lines="none">
              <ion-label>Reported at</ion-label>
              <ion-datetime
                displayFormat="hh:mm a"
                [value]="activeIncident.reportedAt"
              ></ion-datetime> </ion-item
            ><ion-item lines="none">
              <ion-label>On</ion-label>
              <ion-datetime
                displayFormat="DD MMM YYYY"
                [value]="activeIncident.reportedAt"
              ></ion-datetime>
            </ion-item>
          </ion-card-content>
          <ion-footer class="button-border-top"
            ><ion-row class="ion-text-center">
              <ion-col size="6" class="ion-padding"
                ><ion-button
                  fill="clear"
                  class="card-footer-button"
                  (click)="activePopupDeleteClicked(activeIncident.id)"
                  >Delete</ion-button
                ></ion-col
              ><ion-col size="6" class="ion-padding button-border-left"
                ><ion-button
                  fill="clear"
                  strong="true"
                  class="card-footer-button"
                  (click)="activePopupCloseClicked()"
                  >Close</ion-button
                ></ion-col
              ></ion-row
            ></ion-footer
          >
        </ion-card>
      </div>
    </div>
  </ng-container>
</ion-content>
