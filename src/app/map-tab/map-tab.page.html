<ion-header>
  <ion-toolbar color="primary">
    <ion-title>
      Map
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ng-container *ngIf="showAddIncidentPopup$ | async as showAddIncidentPopup">
    <div class="container" *ngIf="incidents$ | async as incidents">
      <div class="map-container">
        <agm-map
          [latitude]="latitude"
          [longitude]="longitude"
          [zoom]="zoom"
          [zoomControlOptions]="zoomControlOptions"
          [streetViewControl]="false"
          [clickableIcons]="false"
          [usePanning]="true"
          (centerChange)="centerChanged($event)"
          (mapClick)="mapClicked()"
          ><agm-marker
            *ngFor="let incident of incidents; trackBy: trackByIncidentId"
            [latitude]="incident.latitude"
            [longitude]="incident.longitude"
            [markerClickable]="showAddIncidentPopup === 'false'"
            (markerClick)="incidentClicked(incident)"
          >
          </agm-marker></agm-map
        ><ion-icon
          *ngIf="centerIndicatorVisible"
          name="add-outline"
          class="center-indicator map-center"
        ></ion-icon
        ><ion-fab vertical="top" horizontal="end" slot="fixed">
          <ion-fab-button
            color="secondary"
            [disabled]="showAddIncidentPopup === 'true'"
            (click)="addClicked()"
          >
            <ion-icon name="add"></ion-icon>
          </ion-fab-button>
          <ion-fab-button
            color="danger"
            class="ion-margin-top"
            [disabled]="showAddIncidentPopup === 'true'"
            (click)="deleteClicked(incidents)"
          >
            <ion-icon name="trash-outline"></ion-icon>
          </ion-fab-button>
          <ion-fab-button
            *ngIf="geolocationAvailable"
            color="light"
            class="ion-margin-top"
            (click)="geolocationClicked()"
          >
            <ion-icon name="navigate-outline"></ion-icon>
          </ion-fab-button>
        </ion-fab>
      </div>
      <div class="incident-container">
        <ion-card *ngIf="showAddIncidentPopup === 'true'">
          <ion-card-content>
            <ion-item lines="none">
              <ion-label position="stacked">Reported at</ion-label>
              add new incident
            </ion-item>
          </ion-card-content>
          <ion-footer class="button-border-top"
            ><ion-row class="ion-text-center">
              <ion-col size="6" class="ion-padding"
                ><ion-button
                  fill="clear"
                  class="card-footer-button"
                  (click)="addPopupCancelClicked()"
                  >Cancel</ion-button
                ></ion-col
              ><ion-col size="6" class="ion-padding button-border-left"
                ><ion-button
                  fill="clear"
                  strong="true"
                  type="submit"
                  class="card-footer-button"
                  (click)="addPopupAddClicked()"
                  >Add</ion-button
                ></ion-col
              ></ion-row
            ></ion-footer
          >
        </ion-card>
        <ion-card *ngIf="activeIncident$ | async as activeIncident">
          <ion-card-content>
            <ion-item lines="none">
              <ion-label position="stacked">Reported at</ion-label>
              {{ activeIncident.reportedAt.toDate() | date:'medium'}}
            </ion-item>
          </ion-card-content>
        </ion-card>
      </div>
    </div>
  </ng-container>
</ion-content>
